# 시스템 아키텍처

## 1️⃣ 전체 시스템 아키텍처 다이어그램

```
┌─────────────────────────────────────────────────────────────────┐
│                         사용자 (브라우저)                          │
└────────────────────────────┬────────────────────────────────────┘
                             │ HTTPS
                             │
┌────────────────────────────▼────────────────────────────────────┐
│                      AWS ALB (Application Load Balancer)        │
│                      - SSL/TLS 종료                              │
│                      - 라우팅 (Frontend/Backend 분리)            │
└────────────┬────────────────────────────────────┬───────────────┘
             │                                    │
    ┌────────▼────────┐                 ┌────────▼────────┐
    │  Frontend (EKS) │                 │  Backend (EKS)  │
    │  - Angular      │                 │  - Spring Boot  │
    │  - Nginx        │                 │  - Multiple Pods│
    │  - Static Files │                 │                 │
    └─────────────────┘                 └────────┬────────┘
                                                 │
                    ┌────────────────────────────┼────────────────────┐
                    │                            │                    │
        ┌───────────▼──────────┐    ┌───────────▼──────────┐   ┌────▼────┐
        │  PostgreSQL (RDS)    │    │  Redis (ElastiCache) │   │  S3     │
        │  - Master/Slave      │    │  - 캐시                │   │  파일   │
        │  - 자동 백업          │    │  - 세션               │   │  저장   │
        └──────────────────────┘    └──────────────────────┘   └─────────┘
```

## 레이어드 아키텍처 (Backend)

```
┌─────────────────────────────────────────────────────────┐
│                    Presentation Layer                    │
│  - REST Controllers                                      │
│  - Request/Response DTOs                                 │
│  - Exception Handlers                                    │
└──────────────────────┬──────────────────────────────────┘
                       │
┌──────────────────────▼──────────────────────────────────┐
│                    Application Layer                     │
│  - Use Cases (Service)                                  │
│  - Business Logic                                       │
│  - Transaction Management                               │
└──────────────────────┬──────────────────────────────────┘
                       │
┌──────────────────────▼──────────────────────────────────┐
│                    Domain Layer                          │
│  - Entities (Domain Models)                             │
│  - Value Objects                                        │
│  - Domain Services                                      │
└──────────────────────┬──────────────────────────────────┘
                       │
┌──────────────────────▼──────────────────────────────────┐
│                    Infrastructure Layer                  │
│  - JPA Repositories                                     │
│  - Redis Cache                                          │
│  - External API Clients                                 │
└─────────────────────────────────────────────────────────┘
```

## 컴포넌트 다이어그램

```
┌──────────────────────────────────────────────────────────────┐
│                        Frontend (Angular)                     │
├──────────────────────────────────────────────────────────────┤
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐    │
│  │  Auth    │  │  Account │  │ Transaction│ │  Report  │    │
│  │ Component│  │ Component│  │ Component   │ │ Component│    │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘    │
│       │             │              │              │           │
│       └─────────────┴──────────────┴──────────────┘           │
│                         │                                      │
│                    ┌────▼─────┐                               │
│                    │   API    │                               │
│                    │  Service │                               │
│                    └────┬─────┘                               │
└────────────────────────┼──────────────────────────────────────┘
                         │ HTTP/REST + JWT
┌────────────────────────▼──────────────────────────────────────┐
│                      Backend (Spring Boot)                     │
├──────────────────────────────────────────────────────────────┤
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐    │
│  │   Auth   │  │  Account │  │Transaction│ │  Report  │    │
│  │Controller│  │Controller│  │ Controller │ │Controller│    │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘    │
│       │             │              │              │           │
│  ┌────▼─────┐  ┌────▼─────┐  ┌────▼─────┐  ┌────▼─────┐    │
│  │   Auth   │  │  Account │  │Transaction│ │  Report  │    │
│  │ Service  │  │ Service  │  │  Service  │ │ Service  │    │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘    │
│       │             │              │              │           │
│       └─────────────┴──────────────┴──────────────┘           │
│                         │                                      │
│  ┌──────────────────────▼──────────────────────────────┐     │
│  │              Repository Layer                        │     │
│  │  - UserRepository    - AccountRepository             │     │
│  │  - TransactionRepository  - CategoryRepository       │     │
│  └──────────────────────┬──────────────────────────────┘     │
└─────────────────────────┼─────────────────────────────────────┘
                          │
          ┌───────────────┼───────────────┐
          │               │               │
    ┌─────▼─────┐  ┌─────▼─────┐  ┌─────▼─────┐
    │PostgreSQL │  │   Redis   │  │    S3     │
    └───────────┘  └───────────┘  └───────────┘
```

## 데이터 흐름도

### 사용자 인증 흐름
```
1. 사용자 로그인 요청
   ↓
2. Backend: Credential 검증
   ↓
3. Backend: JWT Token 생성
   ↓
4. Backend: Redis에 Refresh Token 저장
   ↓
5. Frontend: JWT Token 저장 (LocalStorage)
   ↓
6. 이후 요청: Authorization Header에 JWT 포함
```

### 거래 조회 흐름 (캐시 적용)
```
1. 사용자 거래 조회 요청
   ↓
2. Backend: Redis에서 캐시 확인
   ↓
3a. 캐시 Hit → 즉시 반환
3b. 캐시 Miss → DB 조회
   ↓
4. DB 조회 결과 Redis에 캐싱 (TTL: 5분)
   ↓
5. 결과 반환
```

## 확장성 고려사항

### 수평 확장
- Backend: EKS Pod 자동 스케일링 (HPA)
- Frontend: Stateless이므로 무제한 확장 가능
- Database: RDS Read Replica 구성
- Cache: ElastiCache Cluster Mode

### 성능 최적화
- Redis 캐싱으로 DB 부하 감소
- Connection Pool 관리
- 비동기 처리 (거래 내역 대량 조회)
- CDN 활용 (정적 파일)

## 보안 계층

```
┌─────────────────────────────────────────┐
│        Application Firewall (WAF)       │
└──────────────────┬──────────────────────┘
                   │
┌──────────────────▼──────────────────────┐
│        ALB (SSL/TLS 종료)               │
└──────────────────┬──────────────────────┘
                   │
┌──────────────────▼──────────────────────┐
│        Nginx (Rate Limiting)            │
└──────────────────┬──────────────────────┘
                   │
┌──────────────────▼──────────────────────┐
│    Spring Security (JWT 검증)           │
└──────────────────┬──────────────────────┘
                   │
┌──────────────────▼──────────────────────┐
│        Application Logic                │
└─────────────────────────────────────────┘
```
